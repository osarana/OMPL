import collada
import numpy as np

def export_to_collada(verts, faces, geom_name, output_file):
    mesh = collada.Collada()

    effect = collada.material.Effect(f"{geom_name}-effect", [], "lambert", (0.5, 0.5, 0.5))
    mat = collada.material.Material(f"{geom_name}-material", f"{geom_name}-mat", effect)
    mesh.effects.append(effect)
    mesh.materials.append(mat)
    
    vertex_data = np.array(verts, dtype=np.float32)
    face_data = np.array(faces, dtype=np.int32)

    vert_src = collada.source.FloatSource(f"{geom_name}-verts-array", vertex_data.flatten(), ('X', 'Y', 'Z'))
    geom = collada.geometry.Geometry(mesh, f"{geom_name}-geometry", geom_name, [vert_src])

    input_list = collada.source.InputList()
    input_list.addInput(0, 'VERTEX', f"#{vert_src.id}")
    triset = geom.createTriangleSet(face_data, input_list, mat.id)

    geom.primitives.append(triset)
    mesh.geometries.append(geom)

    geom_nodes = [collada.scene.GeometryNode(geom, [collada.scene.MaterialNode(f"{geom_name}-matnode", mat)])]
    scene = collada.scene.Scene("myscene", geom_nodes)
    mesh.scenes.append(scene)
    mesh.scene = scene

    mesh.write(output_write)

def export_scene(mesh, output_file):
    geom_nodes = [collada.scene.GeometryNode(geom) for geom in mesh.geometries]
    scene = collada.scene.Scene("myscene", geom_nodes)
    mesh.scene.append(scene)
    mesh.scene = scene

    mesh.write(output_file)

robot_verts = [
    (-0.8500000118018177, -0.001000005787089295, 0.19999999744188118),
    (-0.8500000120999908, 0.0009999980605927719, 0.20000000294168307),
    (-0.8500000133432714, 0.000999999592680108, -0.19999999620330566),
    (-0.0009999983338126685, 0.001000006605843, 0.20000000734066095),
    (-0.0009999939248307474, -0.0009999951071918596, 0.20000000556655273),
    (-0.8500000105904771, -0.0010000031949533854, -0.1999999954608654),
    (-0.0009999978091486859, 0.0010000059685462668, -0.20000000559887834),
    (-0.000999993161287746, -0.0010000066412618911, -0.1999999925644535),
    (0.0010000052870995431, -0.0009999989128206526, -0.20000000263012002),
    (0.0009999971297202199, -0.0009999958309623695, 0.1999999917447074),
    (0.0009999938745096685, 0.00100000729669536, 0.19999999567190918),
    (0.0009999931972999514, 0.0010000000955339742, -0.19999999700324494),
    (0.8500000084876111, 0.0010000064615091145, -0.1999999958923899),
    (0.8499999987875942, -0.0009999930927469067, -0.2000000043345109),
    (0.8499999888425623, 0.0009999998985148087, 0.19999999487987738),
    (0.8500000024495752, -0.0009999951432471774, 0.19999999748239283),
    (0.0009999932095211927, -0.8499999995486786, 0.20000000180124355),
    (-0.0010000051195369248, -0.8499999897088709, -0.19999999297044346),
    (0.0010000003990870245, -0.8499999989573503, -0.1999999916849799),
    (-0.000999992973617081, -0.8499999925255448, 0.19999999555132636),
    (0.0009999967968137469, 0.849999986326571, 0.1999999935968787),
    (-0.0009999953378351766, 0.849999994256908, 0.1999999915256807),
    (-0.0010000058044646084, 0.849999996228834, -0.20000000611751964),
    (0.0010000015520813777, 0.8500000021188857, -0.19999999558790932)
]

robot_faces = [
    [0, 1, 2], [1, 3, 2], [4, 3, 1], [4, 1, 0], [0, 2, 5], 
    [6, 7, 5], [3, 6, 2], [2, 6, 5], [7, 0, 5], [7, 4, 0], 
    [6, 8, 7], [9, 10, 4], [11, 8, 6], [10, 3, 4], [12, 13, 11], 
    [10, 12, 11], [14, 12, 10], [12, 15, 13], [15, 9, 8], [14, 15, 12], 
    [11, 13, 8], [13, 15, 8], [15, 10, 9], [15, 14, 10], [9, 4, 16], 
    [4, 7, 17], [7, 8, 17], [8, 16, 18], [8, 9, 16], [16, 4, 19], 
    [19, 4, 17], [16, 19, 18], [18, 19, 17], [8, 18, 17], [20, 21, 3], 
    [21, 22, 3], [22, 23, 11], [22, 11, 6], [3, 22, 6], [23, 10, 11], 
    [10, 20, 3], [21, 20, 23], [21, 23, 22], [23, 20, 10]
]

ramp_verts = [
    (3.3000000023542753, 1.5499999936759703, 1.3000000091512718),
    (3.3000000255714408, -1.5499999829423039, 1.3000000155139444),
    (-3.2999999711777654, -1.5500000008530075, -0.25000000523149857),
    (-3.2999999700592335, 1.550000014603293, -0.25000000063015898),
    (-3.2999999775361757, 1.5499999976654737, 1.2999999987268476),
    (-3.2999999847540913, -1.5499999839073801, 1.300000004463781),
    (3.3000000098598545, 1.5499999946842797, -1.3000000007553394),
    (3.2999999802026001, -1.5499999953579178, -1.2999999981339159),
    (-3.2999999703009357, -1.5499999900592605, -1.3000000083081968),
    (3.3000000068266888, -1.5500000109931307, 0.25000000775833947),
    (3.2999999918980913, 1.549999985172348, 0.2500000068067294),
    (-3.299999996105232, 1.5499999962905926, -1.3000000057630936)
]
ramp_faces = [
    [0, 1, 2], [3, 0, 2], [1, 0, 4], [4, 0, 3], [4, 3, 5], 
    [1, 5, 2], [1, 4, 5], [5, 3, 2], [6, 7, 8], [7, 9, 8], 
    [9, 10, 11], [9, 11, 8], [6, 9, 7], [6, 10, 9], [11, 6, 8], [10, 6, 11]
]

lattice_verts = [
    (0.004999998416154741, -0.9950000039598541, -0.5150000022851697),
    (0.005000003739707225, -1.004999990863995, -0.5150000089358704),
    (-0.004999998388613216, -1.0049999889623107, -0.5150000039346092),
    (-0.005000006465971635, -0.994999997037788, -0.5150000051428856),
    (0.004999999575272112, -1.0050000011756037, 0.5150000039472744),
    (-0.004999994290801192, -1.0050000020256753, 0.5150000090650643),
    (0.004999996197246934, -0.995000008192526, 0.514999995314093),
    (-0.005000005599702703, -0.9950000059108156, 0.5150000017319972),
    (0.005000002302654102, 0.005000007065791869, -0.5149999996647843),
    (0.0050000056298322175, -0.004999998704057161, -0.5150000044568045),
    (-0.005000000624956278, -0.005000000772402413, -0.5150000050116026),
    (-0.00499999552668012, 0.005000007262893573, -0.5149999967375994),
    (0.005000005454051841, -0.004999996403217849, 0.5150000030850527),
    (-0.005000002658911258, -0.004999999767400447, 0.5149999975091952),
    (0.004999994004182373, 0.005000001262270616, 0.5150000007610499),
    (-0.004999998854670777, 0.004999997360611226, 0.515000010178852),
    (0.0049999992081261, 1.004999985477021, -0.515000001005917),
    (0.005000007140365561, 0.9949999900673945, -0.5149999978336175),
    (-0.005000005182737432, 0.995000014132019, -0.5149999910462358),
    (-0.005000006027051068, 1.0050000103412589, -0.5149999945227319),
    (0.004999997836134646, 0.9950000073888691, 0.5150000112210864),
    (-0.004999999886858804, 0.9950000038772288, 0.5150000088657886),
    (0.004999996459999484, 1.0049999864057748, 0.5150000108808184),
    (-0.005000001073627867, 1.0049999911438525, 0.5149999940065951)
]

lattice_faces = [
    [0, 1, 2], [3, 0, 2], [1, 4, 2], [4, 5, 2], [0, 6, 1], 
    [6, 4, 1], [7, 0, 3], [7, 6, 0], [5, 3, 2], [5, 7, 3], 
    [4, 6, 5], [6, 7, 5], [8, 9, 10], [11, 8, 10], [9, 12, 10], 
    [12, 13, 10], [8, 14, 9], [14, 12, 9], [15, 8, 11], [15, 14, 8], 
    [13, 11, 10], [13, 15, 11], [12, 14, 13], [14, 15, 13], [16, 17, 18], 
    [19, 16, 18], [17, 20, 18], [20, 21, 18], [16, 22, 17], [22, 20, 17], 
    [23, 16, 19], [23, 22, 16], [21, 19, 18], [21, 23, 19], [20, 22, 21], 
    [22, 23, 21], [24, 25, 26], [27, 24, 26], [25, 28, 26], [28, 29, 26], 
    [24, 30, 25], [30, 28, 25], [31, 24, 27], [31, 30, 24], [29, 27, 26], 
    [29, 31, 27], [28, 30, 29], [30, 31, 29], [32, 33, 34], [35, 32, 34], 
    [33, 36, 34], [36, 37, 34], [32, 38, 33], [38, 36, 33], [39, 32, 35], 
    [39, 38, 32], [37, 35, 34], [37, 39, 35], [36, 38, 37], [38, 39, 37], 
    [40, 41, 42], [43, 40, 42], [41, 44, 42], [44, 45, 42], [40, 46, 41], 
    [46, 44, 41], [47, 40, 43], [47, 46, 40], [45, 43, 42], [45, 47, 43], 
    [44, 46, 45], [46, 47, 45], [48, 49, 50], [51, 48, 50], [49, 52, 50], 
    [52, 53, 50], [48, 54, 49], [54, 52, 49], [55, 48, 51], [55, 54, 48], 
    [53, 51, 50], [53, 55, 51], [52, 54, 53], [54, 55, 53], [56, 57, 58], 
    [59, 56, 58], [57, 60, 58], [60, 61, 58], [56, 62, 57], [62, 60, 57], 
    [63, 56, 59], [63, 62, 56], [61, 59, 58], [61, 63, 59], [60, 62, 61], 
    [62, 63, 61], [64, 65, 66], [67, 64, 66], [65, 68, 66], [68, 69, 66], 
    [64, 70, 65], [70, 68, 65], [71, 64, 67], [71, 70, 64], [69, 67, 66], 
    [69, 71, 67], [68, 70, 69], [70, 71, 69]
]

robot_mesh = collada.Collada()
export_to_collada(robot_verts, robot_faces, "robot", robot_mesh)
export_scene(robot_mesh, "skinny_lattice_robot.dae")

environment_mesh = collada.Collada()
export_to_collada(ramp_verts, ramp_faces, "ramp", environment_mesh)
export_to_collada(lattice_verts, lattice_faces, "lattice", environment_mesh)
export_scene(environment_mesh, "skinny_lattice_env.dae")
